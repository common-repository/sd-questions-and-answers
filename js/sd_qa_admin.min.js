function sd_qa(){$=jQuery;this.close_dialog=function(a){a.empty();a.dialog("close");$("body").css("overflow","auto");a.parent().parent().removeClass("sd_qa")},this.check_question=function(a){var c=this;$("body").css("overflow","hidden");var d=$("<div />").dialog({beforeClose:function(){$(this).empty();$("body").css("overflow","auto")},height:"auto",modal:false,position:["center",50],resizable:false,title:"Edit",width:500});c.setup_dialog(d);var b=jQuery.extend(true,{},this.ajaxoptions);b.type="check_question";b.question_id=a;$.post(this.ajaxurl,b,function(f){try{result=c.parseJSON(f);d.html(result.html);c.unset_busy(d);$("#__question_text").focus();$("#__accept").click(function(){var g=$(this);g.attr("disabled",true);b.type="accept_question";$.each(["input","textarea"],function(h,j){var i=$(j,d);$.each(i,function(l,m){var k=$(m);var n=$(m).attr("name");b[n]=k.val()})});$.post(c.ajaxurl,b,function(i){try{result=c.parseJSON(i);if(result.error!==undefined){throw result.error}c.get_unmoderated_questions();c.get_q_a();c.close_dialog(d)}catch(h){g.removeAttr("disabled");c.message("Error accepting question",h)}})});$("#__ban_ip").click(function(){b.type="ban_ip";$.post(c.ajaxurl,b,function(h){try{result=c.parseJSON(h);c.close_dialog(d);c.get_unmoderated_questions()}catch(g){c.message("Error banning IP","Please try again later.")}})});$("#__delete").click(function(){b.type="delete_question";$.post(c.ajaxurl,b,function(h){try{result=c.parseJSON(h);c.get_unmoderated_questions();c.close_dialog(d)}catch(g){c.message("Error deleting question","Could not delete the question. Please try again later.")}})})}catch(e){}})},this.edit_answer=function(b){caller=this;var c=$("<div />").dialog({beforeClose:function(){$(this).empty();$("body").css("overflow","auto")},height:"auto",modal:false,position:["center",50],resizable:false,title:"Edit",width:500});caller.setup_dialog(c);var a=jQuery.extend(true,{},caller.ajaxoptions);a.type="edit_answer";a.answer_id=b;$.post(caller.ajaxurl,a,function(e){try{result=caller.parseJSON(e);c.html(result.html);caller.unset_busy(c);$("#__delete",c).click(function(){var f=$(this);f.attr("disabled",true);a.type="delete_answer";$.post(caller.ajaxurl,a,function(h){try{result=caller.parseJSON(h);caller.close_dialog(c);caller.get_q_a()}catch(g){caller.message("Error deleting answer","Could not delete the answer. Please try again later.")}finally{f.removeAttr("disabled")}})});$("#__create_message",c).click(function(){var f=$(this);f.attr("disabled",true);a.type="create_message";$.post(caller.ajaxurl,a,function(h){try{result=caller.parseJSON(h);caller.close_dialog(c);caller.get_messages()}catch(g){caller.message("Error creating message","Could not create a message. Please try again later.")}finally{f.removeAttr("disabled")}})});$("#__update",c).click(function(){var f=$(this);f.attr("disabled",true);a.text=$("#__answer_text").val();a.type="update_answer";$.post(caller.ajaxurl,a,function(h){try{result=caller.parseJSON(h);if(result.error!==undefined){throw result.error}caller.close_dialog(c);caller.get_q_a()}catch(g){caller.message("Error updating answer","Could not update the answer. Please try again later: "+g)}finally{f.removeAttr("disabled")}})})}catch(d){}})};this.edit_question=function(a){caller=this;var c=$("<div />").dialog({beforeClose:function(){$(this).empty();$("body").css("overflow","auto")},height:"auto",modal:false,position:["center",50],resizable:false,title:"Edit",width:500});caller.setup_dialog(c);var b=jQuery.extend(true,{},caller.ajaxoptions);b.type="edit_question";b.question_id=a;$.post(caller.ajaxurl,b,function(e){try{result=caller.parseJSON(e);c.html(result.html);caller.unset_busy(c);$("#__delete",c).click(function(){var f=$(this);f.attr("disabled",true);b.type="delete_question";$.post(caller.ajaxurl,b,function(h){try{result=caller.parseJSON(h);caller.close_dialog(c);caller.get_q_a()}catch(g){caller.message("Error deleting question","Could not delete the question. Please try again later.")}finally{f.removeAttr("disabled")}})});$("#__update",c).click(function(){var f=$(this);f.attr("disabled",true);$.each(["input","textarea"],function(g,i){var h=$(i,c);$.each(h,function(k,l){var j=$(l);var m=j.attr("name");b[m]=j.val()})});b.type="update_question";$.post(caller.ajaxurl,b,function(h){try{result=caller.parseJSON(h);if(result.error!==undefined){throw result.error}caller.close_dialog(c);caller.get_q_a()}catch(g){caller.message("Error updating question","Could not update the question. Please try again later: "+g)}finally{f.removeAttr("disabled")}})})}catch(d){}})};this.get_active_filters=function(){var b=jQuery.extend(true,{},this.ajaxoptions);b.type="get_active_filters";b.hash=this.settings.active_filters.hash;var a=this;$.post(this.ajaxurl,b,function(d){try{result=a.parseJSON(d);if(a.settings.active_filters.hash!=result.hash){a.settings.divs.$tab_active_filters.html(result.html);a.settings.active_filters.hash=result.hash;$("tbody td.delete a",a.settings.divs.$tab_active_filters).click(function(){b.type="delete_filter";b.filter_id=$(this).parent().attr("filter_id");$.post(a.ajaxurl,b,function(f){try{result=a.parseJSON(f);a.get_active_filters()}catch(e){a.message("Error deleting filter","Please try again later.")}})})}}catch(c){}})};this.get_messages=function(){var a=this;$.ajax({cache:false,dataType:"html",ifModified:true,success:function(b){$(".messages",a.settings.divs.$tab_messages).html(b).css("cursor","pointer");$(".message_container",a.settings.divs.$tab_messages).click(function(){var d=$("<div />").dialog({beforeClose:function(){$(this).empty();$("body").css("overflow","auto")},height:"auto",modal:false,position:["center",50],resizable:false,title:"Edit",width:500});a.setup_dialog(d);var c=jQuery.extend(true,{},a.ajaxoptions);c.type="edit_message";c.message_id=$(this).attr("message_id");$.post(a.ajaxurl,c,function(f){try{result=a.parseJSON(f);d.html(result.html);a.unset_busy(d);$("#__delete").click(function(){var g=$(this);g.attr("disabled",true);c.type="delete_message";$.post(a.ajaxurl,c,function(i){try{result=a.parseJSON(i);a.close_dialog(d);a.get_messages()}catch(h){a.message("Error deleting message","Could not delete the message. Please try again later.")}finally{g.removeAttr("disabled")}})})}catch(e){}})})},method:"get",url:a.settings.urls.messages,})};this.get_q_a=function(){var b=jQuery.extend(true,{},this.ajaxoptions);b.type="get_q_a";b.hash=this.settings.q_a.hash;var a=this;$.post(this.ajaxurl,b,function(d){try{result=a.parseJSON(d);if(result.hash!=a.settings.q_a.hash){a.settings.divs.$tab_q_a.html(result.html);a.settings.q_a.hash=result.hash;$("tbody td.question",a.settings.divs.$tab_q_a).css("cursor","pointer");$("tbody td .answer",a.settings.divs.$tab_q_a).css("cursor","pointer");$("td.question",a.settings.divs.$tab_q_a).click(function(){a.edit_question($(this).parent().attr("question_id"))});$("td .answer",a.settings.divs.$tab_q_a).click(function(){a.edit_answer($(this).attr("answer_id"))})}}catch(c){}})},this.get_unmoderated_questions=function(){var b=jQuery.extend(true,{},this.ajaxoptions);b.type="get_unmoderated_questions";b.hash=this.settings.unmoderated_questions.hash;var a=this;$.post(this.ajaxurl,b,function(d){try{result=a.parseJSON(d);if(a.settings.unmoderated_questions.hash!=result.hash){a.settings.divs.$tab_unmoderated_questions.html(result.html);$("tbody td",a.settings.divs.$tab_unmoderated_questions).css("cursor","pointer");a.settings.unmoderated_questions.hash=result.hash;$("tbody tr",a.settings.divs.$tab_unmoderated_questions).click(function(){var e=$(this).attr("question_id");a.check_question(e)})}}catch(c){}})},this.init=function(a,b){this.ajaxoptions=$.extend(true,{},a);this.ajaxurl=a.ajaxurl;this.ajaxoptions.ajaxurl=null;this.settings=b;this.init_tabs();this.init_unmoderated_questions();this.init_active_filters();this.init_q_a();this.init_messages()},this.init_active_filters=function(){this.settings.active_filters={};this.settings.active_filters.hash=0;this.get_active_filters();var a=this;setInterval(function(){a.get_active_filters()},60000)},this.init_messages=function(){this.settings.messages={};this.get_messages();var a=$("#add_message_dialog").dialog({autoOpen:false,height:"auto",modal:false,position:["center",50],resizable:true,width:500});var b=this;$("#__add_message").click(function(){a.dialog("open");a.removeClass("screen-reader-text").parent().parent().addClass("sd_qa");$("#__name",a).val(b.settings.moderator_alias);$("#__text",a).focus()});$("#__save_message").click(function(){var c=jQuery.extend(true,{},b.ajaxoptions);c.type="save_message";c.name=$("#__name",a).val();c.text=$("#__text",a).val();b.settings.moderator_alias=c.name;b.set_busy(a);$("input",a).attr("disabled",true);$.post(b.ajaxurl,c,function(e){try{result=b.parseJSON(e);if(result.error!==undefined){throw result.error}if(result.ok===true){b.get_messages();b.unset_busy(a);$("#__text",a).val("");a.dialog("close")}}catch(d){b.message("Error adding message.",d)}finally{b.unset_busy(a);$("input",a).removeAttr("disabled")}})});var b=this;setInterval(function(){b.get_messages()},15000)},this.init_tabs=function(){this.settings.divs.$tabs=$("#sd_qa_admin_tabs").tabs()},this.init_q_a=function(){this.settings.q_a={};this.settings.q_a.hash=0;this.get_q_a();var a=this;setInterval(function(){a.get_q_a()},30000)};this.init_unmoderated_questions=function(){this.settings.unmoderated_questions={};this.settings.unmoderated_questions.hash=0;this.get_unmoderated_questions();var a=this;setInterval(function(){a.get_unmoderated_questions()},30000)},this.message=function(a,b){$("body").css("overflow","hidden");$dialog=$("<div />").dialog({beforeClose:function(){$("body").css("overflow","auto")},height:"auto",modal:true,resizable:false,title:a,}).html(b);caller.setup_dialog($dialog);caller.unset_busy($dialog)};this.parseJSON=function(a){if(a.length<3){throw"No data"}return $.parseJSON(a)};this.set_busy=function(a){return $(a).addClass("busy")},this.setup_dialog=function(a){$("body").css("overflow","none");this.set_busy(a);a.parent().wrap('<div class="sd_qa" />')},this.unset_busy=function(a){return $(a).removeClass("busy")}};